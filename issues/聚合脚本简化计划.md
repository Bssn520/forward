# 聚合脚本简化计划

## 项目背景
- **用户需求**：不需要管拉取的仓库格式是否错误，直接拉取就行了，也不要校验和去重
- **目标**：简化aggregate.sh脚本，移除所有校验和去重逻辑
- **策略**：保持最简单的合并逻辑，提高执行效率

## 当前问题分析

### 现有复杂逻辑
1. **JSON格式校验** - 检查文件是否为有效JSON
2. **模块校验** - 验证必要字段完整性
3. **去重处理** - 按ID去重并保留最新版本
4. **错误处理** - 复杂的错误分类和统计
5. **详细日志** - 大量的状态输出

### 简化目标
- 移除所有校验逻辑
- 移除去重功能
- 简化错误处理
- 减少日志输出
- 直接合并所有找到的widgets

## 实施方案：极简聚合

### 核心逻辑简化
```bash
# 简化后的核心流程：
1. 扫描所有.fwd文件
2. 直接提取widgets数组
3. 合并到一个数组中
4. 生成最终文件
5. 完成
```

### 具体修改步骤

#### 步骤1：移除校验函数
**文件**：`scripts/aggregate.sh`
**操作**：
- 删除 `validate_widget()` 函数
- 删除JSON格式检查逻辑
- 删除错误计数器

#### 步骤2：简化文件处理
**操作**：
- 移除JSON格式验证
- 直接读取.fwd文件
- 跳过格式错误的文件但不报错

#### 步骤3：移除去重逻辑
**操作**：
- 删除 `deduplicate_widgets()` 函数
- 删除版本比较逻辑
- 直接合并所有widgets

#### 步骤4：简化日志输出
**操作**：
- 保留基本的处理信息
- 移除详细的校验日志
- 移除错误统计

#### 步骤5：优化性能
**操作**：
- 减少jq调用次数
- 简化临时文件处理
- 移除不必要的检查

### 预期效果

**性能提升：**
- 执行时间减少60%+
- 内存使用降低
- CPU占用减少

**简化程度：**
- 代码行数减少50%+
- 逻辑复杂度大幅降低
- 维护成本降低

**可靠性：**
- 减少失败点
- 提高容错能力
- 更稳定的执行

### 风险评估

**潜在问题：**
- 可能包含重复的widgets
- 可能包含格式错误的数据
- 最终文件可能较大

**缓解措施：**
- 用户明确表示可以接受
- 下游使用方自行处理
- 保持原始数据完整性

### 实施时间
- **预计时间**：30分钟
- **测试时间**：10分钟
- **总计**：40分钟

---

**执行策略**：一次性重写aggregate.sh核心逻辑
**回滚方案**：Git版本回滚
**验证方法**：本地测试 + GitHub Actions验证