# GitHub Actions工作流精简重构计划

## 项目背景
- **当前问题**：两个工作流文件代码重复率80%，存在大量多余功能
- **目标**：合并为单个精简工作流，去除调试和冗余功能
- **预期效果**：从400+行减少到80-100行，维护成本降低70%

## 重构方案：精简合并

### 1. 文件结构调整
**操作**：
- 删除 `manual-update.yml`
- 重写 `sync-repos.yml` 为精简版
- 重命名为 `sync.yml`

### 2. 功能保留清单
**核心功能**（必须保留）：
- 定时触发：`schedule: cron '0 2 * * *'`
- 手动触发：`workflow_dispatch` 支持仓库选择和强制更新
- 基础环境：checkout、Node.js、依赖安装
- 脚本执行：`scripts/update.sh`
- 版本管理：自动递增补丁版本
- Git操作：提交、推送、标签创建

### 3. 功能移除清单
**多余功能**（全部移除）：
- 详细环境验证步骤（验证权限和环境）
- 冗长日志输出（emoji、时间戳、统计信息）
- 文件数量统计
- Git状态详细检查
- 复杂错误处理逻辑
- 多余的echo输出
- 暂存区文件列表显示
- 执行结果汇总

### 4. 实施步骤

#### 步骤1：创建精简工作流
- **文件**：`.github/workflows/sync.yml`
- **内容**：合并两个工作流的核心功能
- **触发器**：定时 + 手动（支持参数）
- **权限**：`contents: write, actions: read`

#### 步骤2：精简步骤设计
1. **检出代码**：标准checkout
2. **环境设置**：Node.js + 基础依赖
3. **参数处理**：手动触发时的仓库选择
4. **执行更新**：运行update.sh脚本
5. **版本更新**：自动递增版本号
6. **提交推送**：Git操作
7. **创建标签**：Release标签

#### 步骤3：删除旧文件
- 删除 `manual-update.yml`
- 删除 `sync-repos.yml`

#### 步骤4：版本更新
- 更新 `package.json` 版本号
- 提交重构更改

### 5. 预期结果
- **代码行数**：从400+行减少到80-100行
- **维护成本**：单文件维护，降低70%
- **执行效率**：减少不必要步骤，提升性能
- **可读性**：去除冗余，核心逻辑清晰

### 6. 验证计划
- 手动触发测试
- 定时任务验证
- 参数传递测试
- 版本号更新确认

---

**执行时间**：预计30分钟
**风险评估**：低风险，可随时回滚
**批准状态**：待用户确认