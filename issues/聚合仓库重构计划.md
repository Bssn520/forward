# 聚合仓库重构计划

## 📋 项目背景
用户需求：创建一个纯粹的自动更新软件模块聚合仓库，只进行聚合而不对拉取仓库的代码进行任何修改。

## 🎯 重构目标
1. 确保源代码零修改，只进行聚合操作
2. 保持现有的自动化工作流架构
3. 优化聚合逻辑，移除格式修复功能
4. 提升系统稳定性和可维护性

## 📝 详细执行计划

### 阶段1：聚合脚本重构
**文件**：`scripts/aggregate.sh`
**操作**：
1. 移除JSON格式修复逻辑（第85-105行）
2. 移除模块校验函数中的修改操作
3. 重构去重逻辑，基于原始数据进行去重
4. 添加只读模式检查，确保不修改源文件
5. 优化错误处理，跳过无效文件而不修复

**预期结果**：聚合脚本只读取和聚合，不修改任何源文件

### 阶段2：更新脚本优化
**文件**：`scripts/update.sh`
**操作**：
1. 确认rsync操作只进行复制，不修改源文件
2. 优化临时目录管理
3. 添加源文件完整性检查
4. 确保版本管理逻辑正确

**预期结果**：更新流程完全只读，不修改拉取的仓库内容

### 阶段3：配置文件优化
**文件**：`config/repos.json`
**操作**：
1. 添加只读模式配置选项
2. 优化仓库配置结构
3. 添加聚合规则配置

**预期结果**：配置更清晰，支持只读聚合模式

### 阶段4：文档更新
**文件**：`README.md`
**操作**：
1. 更新项目描述，强调只读聚合特性
2. 添加使用说明和注意事项
3. 更新技术栈说明

**预期结果**：文档准确反映项目功能和使用方式

### 阶段5：版本管理
**文件**：`package.json`
**操作**：
1. 更新版本号
2. 提交所有更改
3. 创建新的发布标签

**预期结果**：完成重构并发布新版本

## ⚠️ 关键注意事项
1. 所有操作必须确保源仓库文件不被修改
2. 保持现有工作流的兼容性
3. 测试聚合功能的正确性
4. 确保错误处理机制完善

## 🔍 验证标准
1. 源仓库文件MD5校验保持不变
2. 聚合结果正确且完整
3. 自动化工作流正常运行
4. 错误情况下系统稳定运行

---
**创建时间**：$(date '+%Y-%m-%d %H:%M:%S')
**状态**：待批准