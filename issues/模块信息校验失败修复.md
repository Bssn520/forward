# 模块信息校验失败修复任务

## 任务背景
用户反馈软件内显示模块信息校验失败，经分析发现forward-widgets.fwd文件中存在重复模块ID和格式不规范问题。

## 问题分析
1. **重复模块ID**：文件中存在多个相同ID的模块（如douban、live、tv_live等）
2. **版本不一致**：同一模块的不同版本混合存在
3. **汇聚脚本缺陷**：aggregate.sh脚本没有去重逻辑
4. **格式不规范**：部分模块缺少必要的校验字段

## 执行计划

### 步骤1：修改汇聚脚本添加去重逻辑
- 文件：`scripts/aggregate.sh`
- 函数：添加`deduplicate_widgets`函数
- 逻辑概要：
  - 按模块ID分组
  - 比较版本号，保留最新版本
  - 处理版本号格式不一致问题
- 预期结果：脚本能自动去除重复模块

### 步骤2：添加版本比较函数
- 文件：`scripts/aggregate.sh`
- 函数：添加`compare_versions`函数
- 逻辑概要：
  - 解析语义化版本号
  - 支持不同版本号格式
  - 返回版本比较结果
- 预期结果：能正确比较模块版本

### 步骤3：优化模块格式标准化
- 文件：`scripts/aggregate.sh`
- 函数：修改现有的jq转换逻辑
- 逻辑概要：
  - 确保所有必要字段存在
  - 统一functionName生成规则
  - 验证模块格式完整性
- 预期结果：生成符合ForwardWidget标准的模块

### 步骤4：添加校验和日志功能
- 文件：`scripts/aggregate.sh`
- 函数：添加`validate_widget`函数
- 逻辑概要：
  - 检查必要字段完整性
  - 验证URL有效性
  - 输出详细的处理日志
- 预期结果：提供详细的处理反馈

### 步骤5：重新生成汇聚文件
- 文件：`forward-widgets.fwd`
- 操作：运行修改后的汇聚脚本
- 逻辑概要：
  - 清理现有文件
  - 重新汇聚所有模块
  - 验证生成结果
- 预期结果：生成无重复、格式规范的汇聚文件

### 步骤6：更新版本号和提交
- 文件：`package.json`、`CHANGELOG.md`
- 操作：更新项目版本号
- 逻辑概要：
  - 递增版本号
  - 记录修复内容
  - 提交代码变更
- 预期结果：完成版本管理和代码提交

## 技术要点
- 使用jq进行JSON处理和去重
- 实现语义化版本号比较
- 确保脚本在macOS和Linux环境兼容
- 添加错误处理和回滚机制

## 预期结果
- 解决模块信息校验失败问题
- 消除重复模块ID
- 建立自动去重机制
- 提升汇聚文件质量